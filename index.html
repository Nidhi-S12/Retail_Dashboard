<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Indian Retail Trends Dashboard</title>
    
    <!-- React and React DOM from CDN -->
    <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://cdn.jsdelivr.net/npm/@babel/standalone@7.23.2/babel.min.js"></script>
    
    <!-- Tailwind CSS from CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Chart.js for data visualization -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    
    <!-- Simple CSS for additional styling -->
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f7f9fc;
        }
        
        .card {
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }
        
        .trending-badge {
            position: absolute;
            top: -10px;
            right: -10px;
            background: linear-gradient(45deg, #ff6b6b, #ff9e7d);
            color: white;
            border-radius: 20px;
            padding: 5px 10px;
            font-size: 0.7rem;
            font-weight: bold;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            z-index: 10;
        }
        
        .chart-container {
            position: relative;
            height: 250px;
            width: 100%;
        }
        
        .dashboard-header {
            background: linear-gradient(135deg, #6366f1 0%, #a855f7 100%);
        }
        
        .recommendation-high {
            background: linear-gradient(45deg, #10b981, #059669);
        }
        
        .recommendation-moderate {
            background: linear-gradient(45deg, #f59e0b, #d97706);
        }
        
        .recommendation-caution {
            background: linear-gradient(45deg, #ef4444, #dc2626);
        }
        
        .recommendation-standard {
            background: linear-gradient(45deg, #6b7280, #4b5563);
        }
        
        .product-card {
            border-radius: 12px;
            overflow: hidden;
            border-width: 1px;
            border-color: #e5e7eb;
        }
        
        .skeleton-loader {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
            border-radius: 4px;
        }
        
        @keyframes loading {
            0% {
                background-position: 200% 0;
            }
            100% {
                background-position: -200% 0;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <!-- Load our data -->
    <script type="text/babel">
         // This will be replaced with actual data from our Python script
         let retailTrendsData = [];
         
         // Fetch data from JSON file
         fetch('./data/retail_trends_data.json')
             .then(response => response.json())
             .then(data => {
                 retailTrendsData = data;
                 console.log('Data loaded successfully:', retailTrendsData.length, 'entries');
                 // Render app after data is loaded
                 const root = ReactDOM.createRoot(document.getElementById('root'));
                 root.render(<App data={retailTrendsData} />);
             })
             .catch(error => {
                 console.error('Error loading data:', error);
                 // Show error message or load fallback data
                 alert('Error loading data. Please check console for details.');
             });
    </script>
    
    <!-- React Application -->
    <script type="text/babel">
        // Main App Component
        const App = ({ data }) => {
            const [selectedRegion, setSelectedRegion] = React.useState('All');
            const [selectedCategory, setSelectedCategory] = React.useState('All');
            const [showTrending, setShowTrending] = React.useState(false);
            const [selectedProduct, setSelectedProduct] = React.useState(null);
            const [isDataLoaded, setIsDataLoaded] = React.useState(false);
            
            // Extract unique regions from data
            const allRegions = React.useMemo(() => {
                if (!data || data.length === 0) return [];
                
                const regions = [...new Set(data.map(item => item.region))];
                const regionTypes = [...new Set(data.map(item => item.region_type))];
                
                return [
                    { value: 'All', label: 'All Regions' },
                    ...regionTypes.map(type => ({ 
                        value: `type:${type}`, 
                        label: `${type} Cities` 
                    })),
                    ...regions.map(region => ({ value: region, label: region }))
                ];
            }, [data]);
            
            // Extract unique categories from data
            const allCategories = React.useMemo(() => {
                if (!data || data.length === 0) return [];
                
                const categories = [...new Set(data.map(item => item.category))];
                return [
                    { value: 'All', label: 'All Categories' },
                    ...categories.map(category => ({ value: category, label: category }))
                ];
            }, [data]);
            
            // Filter data based on selected filters
            const filteredData = React.useMemo(() => {
                if (!data || data.length === 0) return [];
                
                let filtered = [...data];
                
                // Filter by region
                if (selectedRegion !== 'All') {
                    if (selectedRegion.startsWith('type:')) {
                        const regionType = selectedRegion.split(':')[1];
                        filtered = filtered.filter(item => item.region_type === regionType);
                    } else {
                        filtered = filtered.filter(item => item.region === selectedRegion);
                    }
                }
                
                // Filter by category
                if (selectedCategory !== 'All') {
                    filtered = filtered.filter(item => item.category === selectedCategory);
                }
                
                // Filter by trending status
                if (showTrending) {
                    filtered = filtered.filter(item => item.is_trending);
                }
                
                return filtered;
            }, [data, selectedRegion, selectedCategory, showTrending]);
            
            // Group data by product name for aggregated metrics
            const productSummary = React.useMemo(() => {
                if (!filteredData || filteredData.length === 0) return [];
                
                const summary = {};
                
                filteredData.forEach(item => {
                    if (!summary[item.name]) {
                        summary[item.name] = {
                            id: item.id,
                            name: item.name,
                            category: item.category,
                            totalMentions: 0,
                            regions: new Set(),
                            isTrending: false,
                            positiveSentiment: 0,
                            neutralSentiment: 0,
                            negativeSentiment: 0,
                            overallSentiment: 0,
                            data: []
                        };
                    }
                    
                    const product = summary[item.name];
                    product.totalMentions += item.total_mentions;
                    product.regions.add(item.region);
                    product.isTrending = product.isTrending || item.is_trending;
                    product.positiveSentiment += item.sentiment_counts.positive;
                    product.neutralSentiment += item.sentiment_counts.neutral;
                    product.negativeSentiment += item.sentiment_counts.negative;
                    product.data.push(item);
                });
                
                // Calculate overall sentiment score and format data
                Object.values(summary).forEach(product => {
                    const total = product.positiveSentiment + product.neutralSentiment + product.negativeSentiment;
                    product.positiveSentimentPercent = total > 0 ? (product.positiveSentiment / total * 100).toFixed(1) : 0;
                    product.neutralSentimentPercent = total > 0 ? (product.neutralSentiment / total * 100).toFixed(1) : 0;
                    product.negativeSentimentPercent = total > 0 ? (product.negativeSentiment / total * 100).toFixed(1) : 0;
                    
                    product.overallSentiment = total > 0 ? 
                        ((product.positiveSentiment * 1) + (product.neutralSentiment * 0) + (product.negativeSentiment * -1)) / total : 0;
                    
                    product.regionsCount = product.regions.size;
                    product.regions = Array.from(product.regions);
                });
                
                // Sort products by total mentions or trending status
                let summaryList = Object.values(summary).sort((a, b) => {
                    if (a.isTrending && !b.isTrending) return -1;
                    if (!a.isTrending && b.isTrending) return 1;
                    return b.totalMentions - a.totalMentions;
                });
                
                // When showing trending across all regions, limit to top 3 trending products per category
                if (showTrending && selectedRegion === 'All') {
                    const groupedByCategory = summaryList.reduce((acc, prod) => {
                        acc[prod.category] = acc[prod.category] || [];
                        acc[prod.category].push(prod);
                        return acc;
                    }, {});
                    summaryList = Object.values(groupedByCategory).flatMap(list => list.slice(0, 3));
                }
                
                return summaryList;
            }, [filteredData, showTrending, selectedRegion]);
            
            // Simulate loading data
            React.useEffect(() => {
                const timer = setTimeout(() => {
                    setIsDataLoaded(true);
                }, 1500);
                
                return () => clearTimeout(timer);
            }, []);
            
            // Handle product click
            const handleProductClick = (product) => {
                setSelectedProduct(product);
                window.scrollTo({ top: 0, behavior: 'smooth' });
            };
            
            // Close product detail modal
            const closeProductDetail = () => {
                setSelectedProduct(null);
            };
            
            // Get recommendation class based on recommendation text
            const getRecommendationClass = (recommendation) => {
                if (recommendation.includes('High Demand')) return 'recommendation-high';
                if (recommendation.includes('Moderate Demand')) return 'recommendation-moderate';
                if (recommendation.includes('Caution')) return 'recommendation-caution';
                return 'recommendation-standard';
            };
            
            return (
                <div className="min-h-screen bg-gray-50">
                    {/* Header */}
                    <header className="dashboard-header text-white p-6 shadow-lg">
                        <div className="container mx-auto">
                            <div className="flex flex-col md:flex-row justify-between items-center">
                                <div>
                                    <h1 className="text-3xl font-bold">Indian Retail Trends</h1>
                                    <p className="text-indigo-100">Social Media Insights Dashboard for Retailers</p>
                                </div>
                                <div className="mt-4 md:mt-0">
                                    <p className="text-sm bg-white bg-opacity-20 px-3 py-1 rounded-full">
                                        <span className="font-semibold">Last Updated:</span> {new Date().toLocaleDateString('en-IN')}
                                    </p>
                                </div>
                            </div>
                        </div>
                    </header>
                    
                    {/* Main Content */}
                    <main className="container mx-auto px-4 py-8">
                        {/* Product Detail Modal */}
                        {selectedProduct && (
                            <ProductDetailModal 
                                product={selectedProduct} 
                                onClose={closeProductDetail}
                                getRecommendationClass={getRecommendationClass}
                            />
                        )}
                        
                        {/* Filters */}
                        <div className="bg-white rounded-lg shadow-md p-6 mb-8">
                            <h2 className="text-lg font-semibold mb-4">Filter Trends</h2>
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                                {/* Region Filter */}
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Region</label>
                                    <select 
                                        className="block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"
                                        value={selectedRegion}
                                        onChange={(e) => setSelectedRegion(e.target.value)}
                                    >
                                        {allRegions.map((region) => (
                                            <option key={region.value} value={region.value}>
                                                {region.label}
                                            </option>
                                        ))}
                                    </select>
                                </div>
                                
                                {/* Category Filter */}
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Category</label>
                                    <select 
                                        className="block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"
                                        value={selectedCategory}
                                        onChange={(e) => setSelectedCategory(e.target.value)}
                                    >
                                        {allCategories.map((category) => (
                                            <option key={category.value} value={category.value}>
                                                {category.label}
                                            </option>
                                        ))}
                                    </select>
                                </div>
                                
                                {/* Trending Toggle */}
                                <div className="flex items-end">
                                    <label className="inline-flex items-center cursor-pointer">
                                        <input 
                                            type="checkbox" 
                                            className="sr-only peer" 
                                            checked={showTrending}
                                            onChange={(e) => setShowTrending(e.target.checked)}
                                        />
                                        <div className="relative w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-indigo-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-indigo-600"></div>
                                        <span className="ml-3 text-sm font-medium text-gray-700">Show Trending Only</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        {/* Dashboard Metrics Summary */}
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                            {/* Total Products */}
                            <div className="bg-white rounded-lg shadow-md p-6">
                                {isDataLoaded ? (
                                    <>
                                        <h3 className="text-gray-500 text-sm font-medium">Total Products</h3>
                                        <p className="text-3xl font-bold">{productSummary.length}</p>
                                        <div className="mt-1 text-xs text-gray-500">
                                            {showTrending ? 'Trending products' : 'Across all regions'}
                                        </div>
                                    </>
                                ) : (
                                    <SkeletonLoader type="metrics" />
                                )}
                            </div>
                            
                            {/* Total Mentions */}
                            <div className="bg-white rounded-lg shadow-md p-6">
                                {isDataLoaded ? (
                                    <>
                                        <h3 className="text-gray-500 text-sm font-medium">Total Mentions</h3>
                                        <p className="text-3xl font-bold">
                                            {productSummary.reduce((sum, product) => sum + product.totalMentions, 0).toLocaleString()}
                                        </p>
                                        <div className="mt-1 text-xs text-gray-500">
                                            On social media in the last 30 days
                                        </div>
                                    </>
                                ) : (
                                    <SkeletonLoader type="metrics" />
                                )}
                            </div>
                            
                            {/* Average Sentiment */}
                            <div className="bg-white rounded-lg shadow-md p-6">
                                {isDataLoaded ? (
                                    <>
                                        <h3 className="text-gray-500 text-sm font-medium">Average Sentiment</h3>
                                        <div className="flex items-center">
                                            <p className="text-3xl font-bold">
                                                {productSummary.length > 0 ? 
                                                    (productSummary.reduce((sum, product) => 
                                                        sum + parseFloat(product.positiveSentimentPercent), 0) / productSummary.length).toFixed(1) + '%' : 
                                                    '0%'
                                                }
                                            </p>
                                            <span className="ml-2 text-green-500">Positive</span>
                                        </div>
                                        <div className="mt-1 text-xs text-gray-500">
                                            Based on sentiment analysis
                                        </div>
                                    </>
                                ) : (
                                    <SkeletonLoader type="metrics" />
                                )}
                            </div>
                            
                            {/* Trending Products */}
                            <div className="bg-white rounded-lg shadow-md p-6">
                                {isDataLoaded ? (
                                    <>
                                        <h3 className="text-gray-500 text-sm font-medium">Trending Products</h3>
                                        <p className="text-3xl font-bold">
                                            {productSummary.filter(product => product.isTrending).length}
                                        </p>
                                        <div className="mt-1 text-xs text-gray-500">
                                            Products with high engagement
                                        </div>
                                    </>
                                ) : (
                                    <SkeletonLoader type="metrics" />
                                )}
                            </div>
                        </div>
                        
                        {/* Product Listings */}
                        <div className="mb-8">
                            <h2 className="text-xl font-semibold mb-4">
                                {showTrending ? 'Trending Products' : 'All Products'} 
                                {selectedRegion !== 'All' && selectedRegion.startsWith('type:') ? 
                                    ` in ${selectedRegion.split(':')[1]} Cities` : 
                                    selectedRegion !== 'All' ? ` in ${selectedRegion}` : ''}
                                {selectedCategory !== 'All' ? ` - ${selectedCategory}` : ''}
                            </h2>
                            
                            {!isDataLoaded ? (
                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                                    {[...Array(8)].map((_, index) => (
                                        <SkeletonLoader key={index} type="product" />
                                    ))}
                                </div>
                            ) : productSummary.length === 0 ? (
                                <div className="bg-white rounded-lg shadow-md p-8 text-center">
                                    <svg className="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                    </svg>
                                    <h3 className="mt-2 text-lg font-medium text-gray-900">No products found</h3>
                                    <p className="mt-1 text-sm text-gray-500">
                                        Try changing your filter criteria to see more products.
                                    </p>
                                </div>
                            ) : (
                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                                    {productSummary.map((product) => (
                                        <ProductCard 
                                            key={product.id} 
                                            product={product} 
                                            onClick={() => handleProductClick(product)}
                                            getRecommendationClass={getRecommendationClass}
                                        />
                                    ))}
                                </div>
                            )}
                        </div>
                    </main>
                    
                    {/* Footer */}
                    <footer className="bg-gray-800 text-white py-6">
                        <div className="container mx-auto px-4">
                            <div className="flex flex-col md:flex-row justify-between items-center">
                                <div className="mb-4 md:mb-0">
                                    <p className="text-sm">
                                        © 2025 Indian Retail Trends Dashboard - Proof of Concept
                                    </p>
                                </div>
                                <div className="text-sm">
                                    <p>Powered by Synthetic Social Media Analytics</p>
                                </div>
                            </div>
                        </div>
                    </footer>
                </div>
            );
        };
        
        // Product Card Component
        const ProductCard = ({ product, onClick, getRecommendationClass }) => {
            const [chartRef, setChartRef] = React.useState(null);
            
            React.useEffect(() => {
                if (chartRef) {
                    const ctx = chartRef.getContext('2d');
                    
                    // Destroy existing chart if it exists
                    if (chartRef.chart) {
                        chartRef.chart.destroy();
                    }
                    
                    // Create new chart
                    chartRef.chart = new Chart(ctx, {
                        type: 'doughnut',
                        data: {
                            labels: ['Positive', 'Neutral', 'Negative'],
                            datasets: [{
                                data: [
                                    product.positiveSentimentPercent,
                                    product.neutralSentimentPercent,
                                    product.negativeSentimentPercent
                                ],
                                backgroundColor: ['#10b981', '#f59e0b', '#ef4444'],
                                borderWidth: 0
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    display: false
                                },
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            return context.label + ': ' + context.raw + '%';
                                        }
                                    }
                                }
                            },
                            cutout: '70%'
                        }
                    });
                }
                
                return () => {
                    if (chartRef && chartRef.chart) {
                        chartRef.chart.destroy();
                    }
                };
            }, [chartRef, product]);
            
            // Get recommendation and determine its class
            const firstDataItem = product.data[0] || {};
            const recommendation = firstDataItem.recommendation || 'Standard Stock Levels';
            const recommendationClass = getRecommendationClass(recommendation);
            
            return (
                <div className="product-card bg-white shadow-md overflow-hidden relative card cursor-pointer" onClick={onClick}>
                    {product.isTrending && (
                        <div className="trending-badge">
                            <svg className="inline-block w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                <path fillRule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03zM12.12 15.12A3 3 0 017 13s.879.5 2.5.5c0-1 .5-4 1.25-4.5.5 1 .786 1.293 1.371 1.879A2.99 2.99 0 0113 13a2.99 2.99 0 01-.879 2.121z" clipRule="evenodd" />
                            </svg>
                            Trending
                        </div>
                    )}
                    
                    <div className="p-4">
                        <div className="flex justify-between items-start mb-3">
                            <div>
                                <h3 className="font-semibold text-lg text-gray-900">{product.name}</h3>
                                <p className="text-sm text-gray-500">{product.category}</p>
                            </div>
                            <span className="bg-indigo-100 text-indigo-800 text-xs font-medium px-2.5 py-0.5 rounded-full">
                                {product.totalMentions.toLocaleString()} mentions
                            </span>
                        </div>
                        
                        <div className="flex justify-between items-center mb-4">
                            <div className="h-20 w-20">
                                <canvas ref={setChartRef}></canvas>
                            </div>
                            <div className="text-right">
                                <div className="flex items-center justify-end mb-1">
                                    <span className="w-3 h-3 bg-green-500 rounded-full mr-1"></span>
                                    <span className="text-sm">{product.positiveSentimentPercent}%</span>
                                </div>
                                <div className="flex items-center justify-end mb-1">
                                    <span className="w-3 h-3 bg-yellow-500 rounded-full mr-1"></span>
                                    <span className="text-sm">{product.neutralSentimentPercent}%</span>
                                </div>
                                <div className="flex items-center justify-end">
                                    <span className="w-3 h-3 bg-red-500 rounded-full mr-1"></span>
                                    <span className="text-sm">{product.negativeSentimentPercent}%</span>
                                </div>
                            </div>
                        </div>
                        
                        <div className={`${recommendationClass} text-white px-3 py-2 rounded-md text-sm font-medium`}>
                            {recommendation}
                        </div>
                        
                        <div className="mt-3 text-xs text-gray-500">
                            Popular in {product.regionsCount} {product.regionsCount === 1 ? 'region' : 'regions'}
                            {product.regions.length > 0 && (
                                <span className="block mt-1 truncate">
                                    Top: {product.regions.slice(0, 2).join(', ')}
                                    {product.regions.length > 2 && ' & more'}
                                </span>
                            )}
                        </div>
                    </div>
                </div>
            );
        };
        
        // Product Detail Modal Component
        const ProductDetailModal = ({ product, onClose, getRecommendationClass }) => {
            const [activeTab, setActiveTab] = React.useState('overview');
            const [chartRef, setChartRef] = React.useState(null);
            const [demoChartRef, setDemoChartRef] = React.useState(null);
            
            React.useEffect(() => {
                if (chartRef) {
                    const ctx = chartRef.getContext('2d');
                    
                    // Destroy existing chart if it exists
                    if (chartRef.chart) {
                        chartRef.chart.destroy();
                    }
                    
                    // Create sentiment chart
                    chartRef.chart = new Chart(ctx, {
                        type: 'pie',
                        data: {
                            labels: ['Positive', 'Neutral', 'Negative'],
                            datasets: [{
                                data: [
                                    product.positiveSentimentPercent,
                                    product.neutralSentimentPercent,
                                    product.negativeSentimentPercent
                                ],
                                backgroundColor: ['#10b981', '#f59e0b', '#ef4444'],
                                borderWidth: 0
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'right'
                                },
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            return context.label + ': ' + context.raw + '%';
                                        }
                                    }
                                }
                            }
                        }
                    });
                }
                
                if (demoChartRef && product.data && product.data.length > 0) {
                    const ctx = demoChartRef.getContext('2d');
                    
                    // Destroy existing chart if it exists
                    if (demoChartRef.chart) {
                        demoChartRef.chart.destroy();
                    }
                    
                    // Get age group data from the first product data item
                    const firstDataItem = product.data[0];
                    if (firstDataItem && firstDataItem.demographics && firstDataItem.demographics.age_groups) {
                        const ageGroups = firstDataItem.demographics.age_groups;
                        
                        // Create demographics chart
                        demoChartRef.chart = new Chart(ctx, {
                            type: 'bar',
                            data: {
                                labels: Object.keys(ageGroups),
                                datasets: [{
                                    label: 'Age Distribution',
                                    data: Object.values(ageGroups).map(val => (val * 100).toFixed(1)),
                                    backgroundColor: 'rgba(99, 102, 241, 0.7)',
                                    borderColor: 'rgba(99, 102, 241, 1)',
                                    borderWidth: 1
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                scales: {
                                    y: {
                                        beginAtZero: true,
                                        max: 50,
                                        ticks: {
                                            callback: function(value) {
                                                return value + '%';
                                            }
                                        }
                                    }
                                },
                                plugins: {
                                    legend: {
                                        display: false
                                    },
                                    tooltip: {
                                        callbacks: {
                                            label: function(context) {
                                                return context.raw + '%';
                                            }
                                        }
                                    }
                                }
                            }
                        });
                    }
                }
                
                return () => {
                    if (chartRef && chartRef.chart) {
                        chartRef.chart.destroy();
                    }
                    if (demoChartRef && demoChartRef.chart) {
                        demoChartRef.chart.destroy();
                    }
                };
            }, [chartRef, demoChartRef, product]);
            
            // Get first data item for detailed information
            const firstDataItem = product.data[0] || {};
            const recommendation = firstDataItem.recommendation || 'Standard Stock Levels';
            const recommendationDetails = firstDataItem.recommendation_details || '';
            const marketingRecommendation = firstDataItem.marketing_recommendation || '';
            const recommendationClass = getRecommendationClass(recommendation);
            
            // Get sample posts from all data items
            const samplePosts = product.data.reduce((posts, item) => {
                if (item.sample_posts && item.sample_posts.length > 0) {
                    posts.push(...item.sample_posts);
                }
                return posts;
            }, []).slice(0, 5);
            
            return (
                <div className="fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center p-4">
                    <div className="bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-hidden">
                        <div className="flex justify-between items-center p-6 border-b">
                            <div>
                                <h2 className="text-2xl font-bold text-gray-900">{product.name}</h2>
                                <p className="text-gray-500">{product.category}</p>
                            </div>
                            <button 
                                onClick={onClose}
                                className="text-gray-400 hover:text-gray-500"
                            >
                                <svg className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                                </svg>
                            </button>
                        </div>
                        
                        <div className="border-b">
                            <nav className="flex">
                                <button
                                    className={`px-4 py-3 text-sm font-medium ${
                                        activeTab === 'overview' 
                                            ? 'border-b-2 border-indigo-500 text-indigo-600' 
                                            : 'text-gray-500 hover:text-gray-700'
                                    }`}
                                    onClick={() => setActiveTab('overview')}
                                >
                                    Overview
                                </button>
                                <button
                                    className={`px-4 py-3 text-sm font-medium ${
                                        activeTab === 'insights' 
                                            ? 'border-b-2 border-indigo-500 text-indigo-600' 
                                            : 'text-gray-500 hover:text-gray-700'
                                    }`}
                                    onClick={() => setActiveTab('insights')}
                                >
                                    Insights & Recommendations
                                </button>
                                <button
                                    className={`px-4 py-3 text-sm font-medium ${
                                        activeTab === 'posts' 
                                            ? 'border-b-2 border-indigo-500 text-indigo-600' 
                                            : 'text-gray-500 hover:text-gray-700'
                                    }`}
                                    onClick={() => setActiveTab('posts')}
                                >
                                    Sample Posts
                                </button>
                            </nav>
                        </div>
                        
                        <div className="p-6 overflow-y-auto" style={{ maxHeight: 'calc(90vh - 130px)' }}>
                            {activeTab === 'overview' && (
                                <div>
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                                        <div className="bg-gray-50 rounded-lg p-4">
                                            <h3 className="text-lg font-medium mb-4">Sentiment Analysis</h3>
                                            <div className="chart-container">
                                                <canvas ref={setChartRef}></canvas>
                                            </div>
                                        </div>
                                        
                                        <div className="bg-gray-50 rounded-lg p-4">
                                            <h3 className="text-lg font-medium mb-4">Demographics</h3>
                                            <div className="chart-container">
                                                <canvas ref={setDemoChartRef}></canvas>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                                        <div className="bg-gray-50 rounded-lg p-4">
                                            <h3 className="text-sm font-medium text-gray-500 mb-1">Total Mentions</h3>
                                            <p className="text-2xl font-bold">{product.totalMentions.toLocaleString()}</p>
                                        </div>
                                        
                                        <div className="bg-gray-50 rounded-lg p-4">
                                            <h3 className="text-sm font-medium text-gray-500 mb-1">Regions</h3>
                                            <p className="text-2xl font-bold">{product.regionsCount}</p>
                                            <p className="text-xs text-gray-500 mt-1">
                                                {product.regions.slice(0, 3).join(', ')}
                                                {product.regions.length > 3 && ' & more'}
                                            </p>
                                        </div>
                                        
                                        <div className="bg-gray-50 rounded-lg p-4">
                                            <h3 className="text-sm font-medium text-gray-500 mb-1">Trending Status</h3>
                                            <p className="text-2xl font-bold flex items-center">
                                                {product.isTrending ? (
                                                    <>
                                                        <svg className="w-6 h-6 text-indigo-600 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                                            <path fillRule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03zM12.12 15.12A3 3 0 017 13s.879.5 2.5.5c0-1 .5-4 1.25-4.5.5 1 .786 1.293 1.371 1.879A2.99 2.99 0 0113 13a2.99 2.99 0 01-.879 2.121z" clipRule="evenodd" />
                                                        </svg>
                                                        Trending
                                                    </>
                                                ) : (
                                                    'Not Trending'
                                                )}
                                            </p>
                                        </div>
                                    </div>
                                    
                                    <div className="bg-gray-50 rounded-lg p-4 mb-6">
                                        <h3 className="text-lg font-medium mb-2">Popular Regions</h3>
                                        <div className="grid grid-cols-2 md:grid-cols-4 gap-2">
                                            {product.regions.slice(0, 8).map((region, index) => (
                                                <div key={index} className="bg-white rounded-md p-2 text-center">
                                                    <span className="text-sm">{region}</span>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                    
                                    <div className="bg-gray-50 rounded-lg p-4">
                                        <h3 className="text-lg font-medium mb-2">Product Tags</h3>
                                        <div className="flex flex-wrap gap-2">
                                            {firstDataItem.tags && firstDataItem.tags.map((tag, index) => (
                                                <span key={index} className="bg-indigo-100 text-indigo-800 text-xs font-medium px-2.5 py-1 rounded-full">
                                                    #{tag}
                                                </span>
                                            ))}
                                        </div>
                                    </div>
                                </div>
                            )}
                            
                            {activeTab === 'insights' && (
                                <div>
                                    <div className="bg-gray-50 rounded-lg p-6 mb-6">
                                        <h3 className="text-lg font-medium mb-2">Inventory Recommendation</h3>
                                        <div className={`${recommendationClass} text-white px-4 py-2 rounded-md text-base font-medium mb-3 inline-block`}>
                                            {recommendation}
                                        </div>
                                        <p className="text-gray-700">{recommendationDetails}</p>
                                    </div>
                                    
                                    <div className="bg-gray-50 rounded-lg p-6 mb-6">
                                        <h3 className="text-lg font-medium mb-2">Marketing Strategy</h3>
                                        <p className="text-gray-700">{marketingRecommendation}</p>
                                        
                                        <h4 className="font-medium mt-4 mb-2">Suggested Hashtags</h4>
                                        <div className="flex flex-wrap gap-2">
                                            {samplePosts.slice(0, 1).map((post) => (
                                                post.text.split(' ').filter(word => word.startsWith('#')).map((hashtag, index) => (
                                                    <span key={index} className="bg-indigo-100 text-indigo-800 text-xs font-medium px-2.5 py-1 rounded-full">
                                                        {hashtag}
                                                    </span>
                                                ))
                                            ))}
                                        </div>
                                    </div>
                                    
                                    <div className="bg-gray-50 rounded-lg p-6 mb-6">
                                        <h3 className="text-lg font-medium mb-2">Target Demographic</h3>
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            <div>
                                                <h4 className="font-medium mb-2">Age Groups</h4>
                                                {firstDataItem.demographics && firstDataItem.demographics.age_groups && (
                                                    <div>
                                                        {Object.entries(firstDataItem.demographics.age_groups)
                                                            .sort((a, b) => b[1] - a[1])
                                                            .map(([ageGroup, percentage], index) => (
                                                                <div key={index} className="mb-2">
                                                                    <div className="flex justify-between mb-1">
                                                                        <span className="text-sm font-medium">{ageGroup}</span>
                                                                        <span className="text-sm">{(percentage * 100).toFixed(1)}%</span>
                                                                    </div>
                                                                    <div className="w-full bg-gray-200 rounded-full h-2">
                                                                        <div 
                                                                            className="bg-indigo-600 h-2 rounded-full"
                                                                            style={{ width: `${percentage * 100}%` }}
                                                                        ></div>
                                                                    </div>
                                                                </div>
                                                            ))
                                                        }
                                                    </div>
                                                )}
                                            </div>
                                            
                                            <div>
                                                <h4 className="font-medium mb-2">Gender Distribution</h4>
                                                {firstDataItem.demographics && firstDataItem.demographics.gender && (
                                                    <div>
                                                        {Object.entries(firstDataItem.demographics.gender).map(([gender, percentage], index) => (
                                                            <div key={index} className="mb-2">
                                                                <div className="flex justify-between mb-1">
                                                                    <span className="text-sm font-medium">{gender.charAt(0).toUpperCase() + gender.slice(1)}</span>
                                                                    <span className="text-sm">{(percentage * 100).toFixed(1)}%</span>
                                                                </div>
                                                                <div className="w-full bg-gray-200 rounded-full h-2">
                                                                    <div 
                                                                        className={`${gender === 'male' ? 'bg-blue-600' : 'bg-pink-600'} h-2 rounded-full`}
                                                                        style={{ width: `${percentage * 100}%` }}
                                                                    ></div>
                                                                </div>
                                                            </div>
                                                        ))}
                                                    </div>
                                                )}
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div className="bg-gray-50 rounded-lg p-6">
                                        <h3 className="text-lg font-medium mb-3">Key Insights</h3>
                                        
                                        <div className="mb-3 p-3 bg-white rounded-md">
                                            <h4 className="font-medium text-indigo-700">Sentiment Analysis</h4>
                                            <p className="text-sm text-gray-700 mt-1">
                                                This product has {product.positiveSentimentPercent}% positive sentiment, indicating 
                                                {parseFloat(product.positiveSentimentPercent) > 70 ? ' strong' : parseFloat(product.positiveSentimentPercent) > 50 ? ' good' : ' moderate'} 
                                                customer satisfaction. 
                                                {parseFloat(product.negativeSentimentPercent) > 20 ? 
                                                    ` However, ${product.negativeSentimentPercent}% negative sentiment suggests areas for improvement.` : 
                                                    ' Negative sentiment is relatively low, which is a good sign.'}
                                            </p>
                                        </div>
                                        
                                        <div className="mb-3 p-3 bg-white rounded-md">
                                            <h4 className="font-medium text-indigo-700">Regional Performance</h4>
                                            <p className="text-sm text-gray-700 mt-1">
                                                This product is popular across {product.regionsCount} regions, with strongest performance in 
                                                {product.regions.slice(0, 2).join(' and ')}.
                                                {product.regionsCount > 5 ? ' Wide geographic appeal suggests potential for national marketing campaigns.' : 
                                                 ' Consider targeted marketing in these specific regions.'}
                                            </p>
                                        </div>
                                        
                                        <div className="p-3 bg-white rounded-md">
                                            <h4 className="font-medium text-indigo-700">Social Media Engagement</h4>
                                            <p className="text-sm text-gray-700 mt-1">
                                                With {product.totalMentions.toLocaleString()} total mentions, this product has 
                                                {product.totalMentions > 1000 ? ' high' : product.totalMentions > 500 ? ' moderate' : ' low'} 
                                                social media engagement.
                                                {product.isTrending ? 
                                                    ' The trending status indicates growing popularity that should be leveraged in marketing.' : 
                                                    ' Consider social media campaigns to increase visibility and engagement.'}
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            )}
                            
                            {activeTab === 'posts' && (
                                <div>
                                    <h3 className="text-lg font-medium mb-4">Sample Social Media Posts</h3>
                                    
                                    {samplePosts.length > 0 ? (
                                        <div className="space-y-4">
                                            {samplePosts.map((post, index) => (
                                                <div 
                                                    key={index} 
                                                    className={`bg-white border rounded-lg p-4 ${
                                                        post.sentiment === 'positive' ? 'border-green-200' : 
                                                        post.sentiment === 'negative' ? 'border-red-200' : 
                                                        'border-yellow-200'
                                                    }`}
                                                >
                                                    <div className="flex justify-between mb-2">
                                                        <span className="text-sm text-gray-500">{post.date}</span>
                                                        <span className={`text-xs font-medium px-2 py-0.5 rounded-full ${
                                                            post.sentiment === 'positive' ? 'bg-green-100 text-green-800' : 
                                                            post.sentiment === 'negative' ? 'bg-red-100 text-red-800' : 
                                                            'bg-yellow-100 text-yellow-800'
                                                        }`}>
                                                            {post.sentiment.charAt(0).toUpperCase() + post.sentiment.slice(1)}
                                                        </span>
                                                    </div>
                                                    <p className="text-gray-800">{post.text}</p>
                                                </div>
                                            ))}
                                        </div>
                                    ) : (
                                        <div className="bg-gray-50 rounded-lg p-6 text-center">
                                            <p className="text-gray-500">No sample posts available</p>
                                        </div>
                                    )}
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };
        
        // Skeleton Loader Component
        const SkeletonLoader = ({ type }) => {
            if (type === 'metrics') {
                return (
                    <div>
                        <div className="skeleton-loader h-5 w-24 mb-2"></div>
                        <div className="skeleton-loader h-8 w-16"></div>
                        <div className="skeleton-loader h-3 w-32 mt-2"></div>
                    </div>
                );
            } else if (type === 'product') {
                return (
                    <div className="bg-white rounded-lg shadow-md p-4 h-60">
                        <div className="skeleton-loader h-6 w-3/4 mb-2"></div>
                        <div className="skeleton-loader h-4 w-1/2 mb-4"></div>
                        
                        <div className="flex justify-between mb-4">
                            <div className="skeleton-loader h-20 w-20 rounded-full"></div>
                            <div className="space-y-2">
                                <div className="skeleton-loader h-4 w-16"></div>
                                <div className="skeleton-loader h-4 w-16"></div>
                                <div className="skeleton-loader h-4 w-16"></div>
                            </div>
                        </div>
                        
                        <div className="skeleton-loader h-8 w-full mb-3"></div>
                        <div className="skeleton-loader h-4 w-2/3"></div>
                    </div>
                );
            }
            
            return null;
        };
    </script>
</body>
</html>
